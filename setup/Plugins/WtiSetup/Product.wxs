<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension">
	<Product Id="C8F4EE7D-F2BA-4E1E-ABDB-C454FC68E780" Name="!(loc.ApplicationLongName)" Language="1043" Version="0.5.0" Manufacturer="!(loc.Manufacturer)" UpgradeCode="8c52b205-2bc3-4281-9d81-080fb1b2105d">
		<Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />
    <Media Id="1" Cabinet="WtiFull.cab" EmbedCab="yes"/>
    <Property Id="ARPPRODUCTICON" Value="Wti.ico" />

		<MajorUpgrade DowngradeErrorMessage="!(loc.DowngradeErrorMessage)" />

    <!-- Specify default installer UI and which folder the user can configure during setup -->
    <UIRef Id="WixUI_InstallDir"/>
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR"/>

    <!-- Requirement: .Net framework 4.5 installed on machine -->
    <PropertyRef Id="NETFRAMEWORK45"/>
    <Condition Message="!(loc.NetFramework45Required)">
      <![CDATA[Installed OR NETFRAMEWORK45]]>
    </Condition>

    <!-- File System hierarchy -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder" Name="PFiles">
        <Directory Id="Deltares" Name="!(loc.Manufacturer)">
          <Directory Id="INSTALLDIR" Name="!(loc.ApplicationLongName)">
            <Directory Id="APPLICATIONDIR" Name="application"/>
            
            <!--
            WtiPayload.wxs defines all files going into this folder. 
            WtiPayload.wxs will be generated on pre-build. Ensure you clean first before building the installer!
            -->

            <Component Id="InstalledShortcut" Guid="441A8BC7-0B13-453D-9FBB-F03293282A3D">
              <Shortcut Id="ApplicationInstallDirShortcut"
                        Name="!(loc.ApplicationLongName)"
                        Target="[APPLICATIONDIR]DeltaShell.Gui.exe"
                        WorkingDirectory="APPLICATIONDIR"
                        Icon="Wti.ico"/>

              <RemoveFolder Id="RemoveINSTALLDIR" Directory="INSTALLDIR" On="uninstall" />
              <RemoveFolder Id="RemoveDeltares" Directory="Deltares" On="uninstall" />
              <RegistryValue Root="HKCU" Key="Software\!(loc.Manufacturer)\!(loc.ApplicationShortName)" Name="wtiAppShortcutInstalled" Type="integer" Value="1" KeyPath="yes"/>
            </Component>
            
          </Directory>
        </Directory>
      </Directory>

      <!-- Start menu folder -->
      <Directory Id="ProgramMenuFolder" Name="Programs">
        <Directory Id="ProgramMenuDeltares" Name="!(loc.Manufacturer)">
          <Directory Id="ProgramMenuWti2017" Name="!(loc.ApplicationLongName)">
            
            <Component Id="ProgramMenuShortcut" Guid="1BF4BE48-FB81-425D-85E4-C30F1BF51DA4">
              <Shortcut Id="ApplicationStartMenuShortcut"
                        Name="!(loc.ApplicationLongName)"
                        Target="[APPLICATIONDIR]DeltaShell.Gui.exe"
                        WorkingDirectory="APPLICATIONDIR"
                        Icon="Wti.ico"/>
              
              <RemoveFolder Id="RemoveProgramMenuShortcut" Directory="ProgramMenuWti2017" On="uninstall" />
              <RemoveFolder Id="RemoveProgramMenuDeltares" Directory="ProgramMenuDeltares" On="uninstall" />
              <RegistryValue Root="HKCU" Key="Software\!(loc.Manufacturer)\!(loc.ApplicationShortName)" Name="wtiProgMenuShortcutInstalled" Type="integer" Value="1" KeyPath="yes"/>
              
            </Component>
            
          </Directory>
        </Directory>
      </Directory>

      <!-- Desktop -->
      <Directory Id="DesktopFolder" Name="Desktop">

        <Component Id="DesktopShortcut" Guid="A871DE12-BE7D-4A80-86F6-5BA23249A8BB">
          <Shortcut Id="ApplicationDesktopShortcut"
                    Name="!(loc.ApplicationLongName)"
                    Target="[APPLICATIONDIR]DeltaShell.Gui.exe"
                    WorkingDirectory="APPLICATIONDIR"
                    Icon="Wti.ico"/>

          <RegistryValue Root="HKCU" Key="Software\!(loc.Manufacturer)\!(loc.ApplicationShortName)" Name="wtiDesktopShortcutInstalled" Type="integer" Value="1" KeyPath="yes"/>

        </Component>

      </Directory>
    </Directory>
    
		<Feature Id="CompleteInstallation" Title="!(loc.ApplicationLongName)" Level="1">
      <ComponentGroupRef Id="WtiApplicationComponents"/>
      <ComponentRef Id="InstalledShortcut"/>
      <ComponentRef Id="ProgramMenuShortcut"/>
      <ComponentRef Id="DesktopShortcut"/>
		</Feature>

    <Icon Id="Wti.ico" SourceFile="Wti.ico"/>
    
	</Product>
</Wix>