<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension">
  <!-- Static variables. -->
  <?include Variables.wxi ?>
  
  <Product Id="*" Name="$(var.ApplicationFullName)" Language="1043" Version="$(var.ReleaseVersion)" Manufacturer="!(loc.Manufacturer)" UpgradeCode="E5E9A96A-5B83-46C3-A2BD-0799785E3A81">
    <!--Comment left empty on purpose to remove auto-generated text.-->
    <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" Languages="1043" Manufacturer="!(loc.Manufacturer)" Comments=" "/>
    
    <Media Id="1" Cabinet="RiskeerFull.cab" EmbedCab="yes"/>
    <Property Id="ARPPRODUCTICON" Value="Ringtoets.ico" />

    <MajorUpgrade DowngradeErrorMessage="!(loc.DowngradeErrorMessage)" AllowSameVersionUpgrades="yes"/>

    <!-- Specify default installer UI and which folder the user can configure during setup -->
    <UIRef Id="WixUI_Deltares"/>
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR"/>
    <WixVariable Id="WixUIBannerBmp" Value="Banner_493x77.bmp" />
    <WixVariable Id="WixUIDialogBmp" Value="Start_493x312.bmp" />

    <!-- Requirement: .Net framework 4.0 installed on machine -->
    <PropertyRef Id="NETFRAMEWORK40FULL"/>
    <PropertyRef Id="NETFRAMEWORK40CLIENT"/>
    <Condition Message="!(loc.NetFramework40Required)">
      <![CDATA[Installed OR NETFRAMEWORK40FULL OR NETFRAMEWORK40CLIENT]]>
    </Condition>

    <!-- Request the common documents folder path -->
    <PropertyRef Id="WIX_DIR_COMMON_DOCUMENTS"/>

    <!-- File System hierarchy -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder" Name="PFiles">
        <Directory Id="WTIDIR" Name="!(loc.ApplicationGroupShortName)">
          <Directory Id="INSTALLDIR" Name="$(var.ApplicationFullName)">
            <Directory Id="BINDIR" Name="bin">
            
              <!--
              RiskeerPayload.wxs defines all files going into this folder. 
              ThirdPartyLicensesPayload.wxs defines all license files for all used 3rd party libraries.
              
              RiskeerPayload.wxs and ThirdPartyLicensesPayload.wxs will be generated on pre-build. Ensure you clean first before building the installer!
              -->

            </Directory>
            
            <Component Id="FileAssociation" Guid="1117D79E-521C-48C3-9E23-549833F7BA09">
              <File Source="Ringtoets.ico" KeyPath="yes"></File>
              
              <RegistryValue Root="HKLM" Key="SOFTWARE\Classes\Ringtoets.rtd" Name="FriendlyTypeName" Value="!(loc.RtdDescription)" Type="string" />
              <ProgId Id="Ringtoets.rtd" Description="!(loc.RtdDescription)" Icon="Ringtoets.ico">
                <Extension Id="rtd" ContentType="application/rtd">
                  <Verb Id="open" TargetFile="fil91CB09E13AB30875601EC5267FEE0EB4" Command="Open" Argument="&quot;%1&quot;"/>
                  <MIME ContentType="application/rtd" Default="yes" />
                </Extension>
              </ProgId>
              
            </Component>
            
            <Component Id="InstalledShortcut" Guid="333E96FE-1B51-485C-8801-A57CE65C62D1">
              <Shortcut Id="ApplicationInstallDirShortcut"
                        Name="!(loc.ApplicationLongName)"
                        Description="!(loc.StartApplicationDescription)"
                        Target="[BINDIR]$(var.Application.Riskeer.TargetFileName)"
                        WorkingDirectory="INSTALLDIR"
                        Icon="Ringtoets.ico"/>
              
              <RemoveFolder Id="RemoveBINDIR" Directory="BINDIR" On="uninstall"/>
              <RemoveFolder Id="RemoveINSTALLDIR" Directory="INSTALLDIR" On="uninstall" />
              <RemoveFolder Id="RemoveWTIDIR" Directory="WTIDIR" On="uninstall" />
              <RegistryValue Root="HKCU" Key="Software\!(loc.Manufacturer)\!(loc.ApplicationShortName)" Name="RiskeerAppShortcutInstalled" Type="integer" Value="1" KeyPath="yes"/>
            </Component>
            
            <Component Id="LicenseFile" Guid="7A302FAD-4BEF-4C0F-805E-406DB172D530">
              <File Id="RiskeerLicense" Name="Licentie.rtf" Source="Licentie.rtf" KeyPath="yes"/>  
            </Component>

            <Component Id="UserManual" Guid="6AD109DF-87BD-4748-BCF6-D1391F12D8A1">
              <File Id="RiskeerUserManual" Name="Gebruikershandleiding Ringtoets 18.1.1.pdf" Source="Gebruikershandleiding Ringtoets 18.1.1.pdf" KeyPath="yes"/>
            </Component>

          </Directory>
        </Directory>
      </Directory>

      <!-- Start menu folder -->
      <Directory Id="ProgramMenuFolder" Name="Programs">
        <Directory Id="ProgramMenuWTI" Name="!(loc.ApplicationGroupShortName)">
          <Directory Id="ProgramMenuRiskeer" Name="!(loc.ApplicationLongName)">
            
            <Component Id="ProgramMenuShortcut" Guid="525A6CF6-DCFF-4F57-8A41-E55660F320D6">
              <Shortcut Id="ApplicationStartMenuShortcut"
                        Name="!(loc.ApplicationLongName)"
                        Description="!(loc.StartApplicationDescription)"
                        Target="[BINDIR]$(var.Application.Riskeer.TargetFileName)"
                        WorkingDirectory="INSTALLDIR"
                        Icon="Ringtoets.ico"/>
              <RemoveFolder Id="RemoveProgramMenuShortcut" Directory="ProgramMenuRiskeer" On="uninstall" />
              <RemoveFolder Id="RemoveProgramMenuWTI" Directory="ProgramMenuWTI" On="uninstall" />
              <RegistryValue Root="HKCU" Key="Software\!(loc.Manufacturer)\!(loc.ApplicationShortName)" Name="RiskeerProgMenuShortcutInstalled" Type="integer" Value="1" KeyPath="yes"/>
            </Component>
            
            <Component Id="ProgramMenuManualShortcut" Guid="30E330BB-E0DF-43EF-9875-16F6FCEB3C66">
              <Shortcut Id="UserManualShortcut"
                        Name="!(loc.UserManualName)"
                        Description="!(loc.UserManualDescription)"
                        Target="[INSTALLDIR]Gebruikershandleiding Ringtoets 18.1.1.pdf"
                        Icon="Manual.ico"/>
              <RegistryValue Root="HKCU" Key="Software\!(loc.Manufacturer)\!(loc.ApplicationShortName)" Name="RiskeerProgMenuManualShortcutInstalled" Type="integer" Value="1" KeyPath="yes"/>
            </Component>
          
          </Directory>
        </Directory>
      </Directory>

      <!-- Desktop -->
      <Directory Id="DesktopFolder" Name="Desktop">

        <Component Id="DesktopShortcut" Guid="D8F009EB-0C8C-4893-ADD2-22314ACCF2A7">
          <Shortcut Id="ApplicationDesktopShortcut"
                    Name="!(loc.ApplicationLongName)"
                    Description="!(loc.StartApplicationDescription)"
                    Target="[BINDIR]$(var.Application.Riskeer.TargetFileName)"
                    WorkingDirectory="INSTALLDIR"
                    Icon="Ringtoets.ico"/>

           <RegistryValue Root="HKCU" Key="Software\!(loc.Manufacturer)\!(loc.ApplicationShortName)" Name="RiskeerDesktopShortcutInstalled" Type="integer" Value="1" KeyPath="yes"/>
        </Component>
      </Directory>

      <!-- Common documents -->
      <Directory Id="WIX_DIR_COMMON_DOCUMENTS">
        <Directory Id="CommonDocumentsApplicationGroup" Name="!(loc.ApplicationGroupShortName)">
          <Directory Id="CommonDocumentsApplication" Name="!(loc.ApplicationShortName)">
            <Directory Id="CommonDocumentsNBPW" Name="NBPW">
              <Component Id="IHWFile" Guid="5BA794B1-2B84-46C5-A6F0-4BBAD110376D">
                <File Source="IHW\voorbeeldbestand_nationaalBestandPrimaireWaterkeringen.dbf"/>
                <File Source="IHW\voorbeeldbestand_nationaalBestandPrimaireWaterkeringen.prj"/>
                <File Source="IHW\voorbeeldbestand_nationaalBestandPrimaireWaterkeringen.qpj"/>
                <File Source="IHW\voorbeeldbestand_nationaalBestandPrimaireWaterkeringen.shp" KeyPath="yes"/>
                <File Source="IHW\voorbeeldbestand_nationaalBestandPrimaireWaterkeringen.shx"/>

                <RemoveFolder Id="RemoveCommonDocumentsNBPW" Directory="CommonDocumentsNBPW" On="uninstall" />
                <RemoveFolder Id="RemoveCommonDocumentsApplication" Directory="CommonDocumentsApplication" On="uninstall" />
              </Component>
            </Directory>
            
            <!-- Examples folder -->
            <Directory Id="CommonDocumentsExamples" Name="!(loc.Examples)">
              <!-- 
              Examples.wxs defines all files going into this folder.
              Examples.wxs will be generated on pre-build. Ensure you clean first before building the installer!
              -->
            </Directory>
          
            <!-- Installation verification -->
            <Directory Id="CommonDocumentsInstallationVerification" Name="!(loc.InstallationVerification)">
              <!-- InstallationVerification.wxs defines all files going into this folder. -->
            </Directory>
            
            <!-- Calculation configuration -->
            <Directory Id="CommonDocumentsCalculationConfiguration" Name="!(loc.CalculationConfigurationXSD)">
              <!-- CalculationConfiguration.wxs defines all files going into this folder. -->
            </Directory>
          
          </Directory>
        </Directory>
      </Directory>
    </Directory>
    
    <Feature Id="CompleteInstallation" Title="!(loc.ApplicationLongName)" Level="1" Absent="disallow" ConfigurableDirectory="INSTALLDIR" AllowAdvertise="no">
      <ComponentGroupRef Id="RiskeerApplicationComponents"/>
      <ComponentGroupRef Id="ThirdPartyLicenseComponents"/>
      <ComponentGroupRef Id="Examples"/>
      <ComponentGroupRef Id="InstallationVerificationFiles"/>
      <ComponentGroupRef Id="CalculationConfigurationFiles"/>
      <ComponentRef Id="InstalledShortcut"/>
      <ComponentRef Id="ProgramMenuShortcut"/>
      <ComponentRef Id="DesktopShortcut"/>
      <ComponentRef Id="LicenseFile"/>
      <ComponentRef Id="UserManual"/>
      <ComponentRef Id="ProgramMenuManualShortcut"/>
      <ComponentRef Id="IHWFile"/>
      <ComponentRef Id="FileAssociation"/>
    </Feature>

    <Icon Id="Ringtoets.ico" SourceFile="Ringtoets.ico"/>
    <Icon Id="Manual.ico" SourceFile="Manual.ico"/>
  </Product>
</Wix>